(window.multistep_editor_jsonpFunction=window.multistep_editor_jsonpFunction||[]).push([[29],{404:function(e,t,n){"use strict";n.d(t,"a",function(){return r});var r=function(){function e(){}return e.throw=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];throw e+": "+t.join(", ")},e.InvalidProcessorExpression="Invalid expression",e.CannotFoundType="Cannot found type",e.CannotFoundTypeConstructor="Cannot found constructor of type",e.CannotFoundStaticMethod="Cannot found static method",e.CannotFoundEnum="Cannot found enumeration",e.InvalidEnumValue="Enum does not contain value",e.DublicateTypesFound="Dublicate types have been detected",e.CommandNotFound="Command not found",e}()},475:function(e,t,n){"use strict";n.d(t,"a",function(){return s});var r=n(166),i=n(29),s=function(){function e(){}return Object.defineProperty(e,"iframeApiPromise",{get:function(){return this._iframeApiSubject.pipe(Object(i.a)(1)).toPromise()},enumerable:!0,configurable:!0}),e.loadCCScript=function(e,t){var n=this;if("undefined"!=typeof CustomersCanvas||document.body.querySelector("#CcIframeApiScript"))"undefined"!=typeof CustomersCanvas&&this._iframeApiSubject.next(CustomersCanvas);else{this._iframeApiSubject=new r.a(1);var i=document.createElement("script");i.type="text/javascript",i.id="CcIframeApiScript",i.onload=function(e){CustomersCanvas&&n._iframeApiSubject.next(CustomersCanvas)},i.onerror=function(e){n._iframeApiSubject.error(e)},i.src=e+t,document.body.appendChild(i)}return this.iframeApiPromise},e._iframeApiSubject=new r.a(1),e}()},476:function(e,t,n){"use strict";n.d(t,"a",function(){return l});var r=n(0),i=n(477),s=n(38),o=n(716),a=n(6),u=n(551),c=n(25),l=function(){function e(e,t,n){void 0===n&&(n=function(){return Promise.resolve()}),this._lastJobKey="init",this._lastExecutedJobSubject=new i.BehaviorSubject("init"),this._commands=e,this._onJobFinish=n,this.logger=new c.Category("command-executer_"+t)}return e.prototype.executeActions=function(e,t,n){var i=this,o=function(a){return r.b(i,void 0,void 0,function(){var i,u,c,l,d,h,p;return r.e(this,function(r){switch(r.label){case 0:if(this.logger.debug(function(){return"Execute '"+a+"'"}),i=Promise.resolve(),!(u=this._commands[a])||void 0===u.execute)return[3,5];if(i=u.execute(e[a],n[a]),!(c=e[a].after)&&Array.isArray(e[a])&&(l=e[a].find(function(e){return e.after}))&&(c=l.after),void 0===c)return[3,4];Object(s.a)(c)||(c=[c]),d=function(e,t,n){var r=n.indexOf(e);return n.indexOf(t)>r},h=0,r.label=1;case 1:return h<c.length?(p=c[h],d(a,p,t)?[3,3]:[4,i]):[3,4];case 2:r.sent(),i=o(p),r.label=3;case 3:return h++,[3,1];case 4:return[3,6];case 5:console.warn("Action "+a+" is not supported! Double check the config."),r.label=6;case 6:return[2,i]}})})},u=this.getJobReady(this._lastJobKey),c=this._lastJobKey=a.a.guid();return u.then(function(){return i.logger.debug(function(){return"Start actons: "+t}),a.a.recursiveJobPromise(t,o)}).then(function(){return i._onJobFinish()}).finally(function(){i.logger.debug(function(){return"End actons: "+t}),i._lastExecutedJobSubject.next(c)})},e.prototype.getJobReady=function(e){return this._lastExecutedJobSubject.pipe(Object(u.filter)(function(t){return t===e}),Object(u.take)(1)).toPromise()},e.prototype.getChangedActions=function(e,t){var n=Object.keys(e).filter(function(t){return a.a.isObjectNotEmpty(e[t])}).filter(function(n){return void 0===t[n]||!function(e,t){return JSON.stringify(e)===JSON.stringify(t)}(e[n],t[n])}),r=n.indexOf("actionsErrorToast");return-1!==r&&n.splice(r,1),n.indexOf("initial")>-1?["initial"].concat(Object(o.a)(n,"initial")):n},e}()},542:function(e,t,n){"use strict";var r=n(0),i=n(21),s=n(22),o=n(404),a=n(27),u=n(405),c=n(369),l=n(376),d=n(390),h=n(381),p=n(373),f=function(){function e(){this._types=new Map;for(var e=[u,c,l,d],t=0;t<e.length;t++)this._loadModuleTypes(e[t]);this._loadModuleTypes({Collection:h.a})}return e.prototype.fromConstructor=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];Object(p.e)(e)&&o.a.throw("Invalid argument",e);var i=this._findFunction(e);this._isConstructor(i)||o.a.throw(o.a.CannotFoundTypeConstructor,e);var s=i;try{return new(s.bind.apply(s,r.i([void 0],t)))}catch(e){throw console.error(e),e}},e.prototype._findFunction=function(e){var t=e.split(".");this._types.has(t[0])||o.a.throw(o.a.CannotFoundType,e);for(var n=this._types.get(t[0]),r=1;r<t.length;r++)void 0==n[t[r]]&&o.a.throw(o.a.CannotFoundTypeConstructor,e),n=n[t[r]];return n},e.prototype._isConstructor=function(e){return e instanceof Function&&null!=e.prototype.constructor},e.prototype.fromStaticMethod=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var i=this._findFunction(e);null!=i&&i instanceof Function||o.a.throw(o.a.CannotFoundStaticMethod,e);try{return i.apply(void 0,r.i(t))}catch(e){throw console.error(e),e}},e.prototype.fromProperties=function(e,t){var n=this.fromConstructor(e);return Object(p.a)(n,[t],{deep:!1,ignoreNull:!1})},e.prototype.fromEnum=function(e,t){this._types.has(e)||o.a.throw(o.a.CannotFoundEnum,e);var n=this._types.get(e);return n instanceof Object||o.a.throw(o.a.CannotFoundEnum,e),null==n[t]&&o.a.throw(o.a.InvalidEnumValue,{type:e,value:t}),n[t]},e.prototype._loadModuleTypes=function(e){var t,n;if(void 0!==e)try{for(var i=r.j(Object.entries(e)),s=i.next();!s.done;s=i.next()){var a=r.h(s.value,2),u=a[0],c=a[1];(c instanceof Function||c instanceof Object)&&(this._types.has(u)&&o.a.throw(o.a.DublicateTypesFound,u),this._types.set(u,c))}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e}();n.d(t,"a",function(){return g});var g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.d(t,e),t.prototype.subProcessorAllocatorFactory=function(){var e=new a.a;return e.register(new m(this,new f)),e},t}(s.a),m=function(e){function t(t,n){var r=e.call(this,t)||this;return r._builder=n,r}return r.d(t,e),t.prototype.apply=function(e,t,n){var i,s;switch(void 0===n&&(n=function(e){return e}),!0){case Array.isArray(e):return e.map(function(e){return n(e)});case this.isObject(e):var o={};try{for(var a=r.j(Object.entries(e)),u=a.next();!u.done;u=a.next()){var c=r.h(u.value,2),l=c[0],d=c[1];if(this._isNewExpression(l)||this._isCallExpression(l))return this._buildObjectModel(l,d,n);o[l]=this._buildModelProperty(d,n)}}catch(e){i={error:e}}finally{try{u&&!u.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}return o;case this._isEnumExpression(e):return this._parseEnum(e);default:return e}},t.prototype._buildModelProperty=function(e,t){switch(!0){case this.isObject(e):return t(e);case this._isEnumExpression(e):return this._parseEnum(e);default:return e}},t.prototype._parseArguments=function(e,t){var n=this;switch(!0){case Array.isArray(e):return e.map(function(e){return n._parseArguments(e,t)});case this.isObject(e)&&this.canApply(e):return t(e);case this._isEnumExpression(e):return this._parseEnum(e);default:return e}},t.prototype._parseEnum=function(e){var t=this.splitOperandAndCondition(e);1===t.length&&null!=t[0].body||o.a.throw(o.a.InvalidProcessorExpression,e);var n=t[0].body.split(".");return 2==n.length?this._builder.fromEnum(n[0],n[1]):null},t.prototype._buildObjectModel=function(e,t,n){var r=this.splitOperandAndCondition(e);1==r.length&&null!=r[0].body||o.a.throw(o.a.InvalidProcessorExpression,e);var i=r[0].body;return this._isCallExpression(e)?this._buildObjectByFactory(i,t,n):this._createObjectModel(i,t,n)},t.prototype._buildObjectByFactory=function(e,t,n){var r=this,i=t;return Array.isArray(t)?i=t.map(function(e){return r._parseArguments(e,n)}):this.isObject(t)&&(i=n(t)),this._builder.fromStaticMethod(e,i)},t.prototype._createObjectModel=function(e,t,n){var i,s=this;switch(!0){case this.isObject(t):return this._builder.fromProperties(e,n(t));case Array.isArray(t):var o=t.map(function(e){return s._parseArguments(e,n)});return(i=this._builder).fromConstructor.apply(i,r.i([e],o));default:return this._builder.fromConstructor(e,t)}},t.prototype.canApply=function(e){var t=this;return this.isObject(e)&&void 0!==Object.entries(e).find(function(e){var n=r.h(e,2),i=n[0],s=n[1];return t._isNewExpression(i)||t._isCallExpression(i)||t._isEnumExpression(s)})},t.prototype._isNewExpression=function(e){return/{{.*(#new).*/gi.test(e)},t.prototype._isCallExpression=function(e){return/{{.*(#call).*/gi.test(e)},t.prototype._isEnumExpression=function(e){return this.isString(e)&&/{{.*(#enum).*/gi.test(e)},t}(i.a)},867:function(e,t){e.exports="<style>\r\n    :host {\r\n        width: 100%;\r\n        height: 100%;\r\n        display: block;\r\n        position: relative;\r\n    }\r\n\r\n    #design-editor {\r\n        position: absolute;\r\n        height: 1px;\r\n        min-height: 100%;\r\n        width: 1px;\r\n        min-width: 100%;\r\n        top: 0;\r\n        bottom: 0;\r\n        left: 0;\r\n        right: 0;\r\n        border: none;\r\n        background-color: transparent;\r\n    }\r\n</style>\r\n<iframe id='design-editor' allowfullscreen></iframe>"},921:function(e,t,n){"use strict";n.r(t);var r=n(0),i=n(867),s=n(117),o=n(167),a=n(29),u=(function(){}(),function(){return function(e){Object.assign(this,e)}}()),c=(function(){}(),function(){}(),n(395)),l=n(456),d=n(457),h=n(458),p=n(459),f=n(460),g=n(434),m=n(464),v=n(414),b=n(397),y=n(473),w=n(6),P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._customersCanvasSubject=new o.ReplaySubject(1),t}return r.d(t,e),t.prototype.customersCanvasPublish=function(e){this._customersCanvasSubject.next(e)},Object.defineProperty(t.prototype,"customersCanvasObservable",{get:function(){return this._customersCanvasSubject.asObservable()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"customersCanvasPromise",{get:function(){return this.customersCanvasObservable.pipe(Object(a.a)(1)).toPromise()},enumerable:!0,configurable:!0}),t.prototype.getProduct=function(){return r.b(this,void 0,void 0,function(){return r.e(this,function(e){switch(e.label){case 0:return[4,this.getEditor()];case 1:return[4,e.sent().getProduct()];case 2:return[2,e.sent()]}})})},t.prototype.getEditor=function(){return r.b(this,void 0,void 0,function(){return r.e(this,function(e){switch(e.label){case 0:return[4,this._customersCanvasSubject.asObservable().pipe(Object(a.a)(1)).toPromise()];case 1:return[2,e.sent()]}})})},t.prototype.getDesignEditorItemModel=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,s,o,a,P,C,I,_,x,O,A,E,j,S,M;return r.e(this,function(r){switch(r.label){case 0:if(t=e.type===f.b.type,n=e.type===c.a.type||e.type===d.a.type||e.type===h.a.type||e.type===p.a.type||e.type===l.a.type,e.type===g.a.type,i=!1,s=!1,!e)return[2];switch(o={name:e.name},t&&(e=e,i=w.a.isNotNullOrUndefined(e.content)&&(e.content instanceof g.a||"ImageItem"===e.content.type),s=w.a.isNotNullOrUndefined(e.content)&&(e.content instanceof m.b||"BarcodeItem"===e.content.type)),n&&(e=e),!0){case t&&i&&!s&&null!==e.content.tags.sourceData&&void 0!==e.content.tags.sourceData:return[3,1];case t&&i:return[3,7];case n&&!!e.text:return[3,8]}return[3,9];case 1:return a=(e=e).content,P=new b.a(e),C=P.getTransformedRectangle(),I=new v.a(a),_=I.getTransformedRectangle(),[4,this.getEditor()];case 2:x=r.sent(),O=300,r.label=3;case 3:return r.trys.push([3,5,,6]),[4,x.eval("var printArea = spEditor.productHandler.product.surfaces.elementAt(0).printAreas.elementAt(0);var config = spEditor.configuration.renderingConfig.getHiResRendering(printArea);config.dpi;")];case 4:return O=r.sent(),[3,6];case 5:return r.sent(),console.warn("Failed to get hires render config dpi"),[3,6];case 6:return o.tags=Object(y.a)(a.tags),o.value=a.tags.sourceData.name,o.placeholderContent={originalUrl:a.tags.sourceData.originalUrl,width:a.source.width,height:a.source.height,placeholderRectangle:C,contentRectangle:_,contentResizeMode:f.c[e.contentResizeMode].toLowerCase(),contentTransform:{angle:a.transform.angle,scaleX:a.transform.scaleX,scaleY:a.transform.scaleY,translateX:a.transform.translateX,translateY:a.transform.translateY},dpi:O},[3,9];case 7:return o={name:e.name,tags:Object(y.a)(e.tags)},[3,9];case 8:return E="",j=function(e){return(e/255).toFixed(7)},(A=e).color&&("RgbColor"===A.color.type?(S=A.color,E="rgb("+S.r+","+S.g+","+S.b+","+j(S.a)+")"):"CmykColor"===A.color.type&&(M=A.color,E="cmyk("+j(M.c)+","+j(M.m)+","+j(M.y)+","+j(M.k)+","+j(M.a)+")")),o={name:e.name,value:A.text,color:E,font:{postScriptName:A.font.postScriptName,size:A.font.size,fauxBold:A.font.fauxBold,fauxItalic:A.font.fauxItalic}},[3,9];case 9:return t&&((e=e).contentPermissions&&e.contentPermissions.imagePermissions&&(o.contentPermissions={imagePermissions:{allowChangeImage:e.contentPermissions.imagePermissions.allowChangeImage,allowEditImage:e.contentPermissions.imagePermissions.allowEditImage}}),e.placeholderPermissions&&(o.placeholderPermissions={allowEditContent:e.placeholderPermissions.allowEditContent,showHandleButton:e.placeholderPermissions.showHandleButton,showSelectButton:e.placeholderPermissions.showSelectButton})),e.visualizationPermissions&&(o.visualizationPermissions={noPrint:e.visualizationPermissions.noPrint,noShow:e.visualizationPermissions.noShow}),null!==e.locked&&(o.locked=e.locked),[2,new u(o)]}})})},t}(s.c),C=function(){return function(e){this.widget=e}}(),I=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}r.d(t,e),t.prototype.execute=function(e,t){return r.b(this,void 0,void 0,function(){return r.e(this,function(e){throw"Not Implemented"})})}}(C),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.d(t,e),t.prototype.execute=function(e){return r.b(this,void 0,void 0,function(){var t,n;return r.e(this,function(r){switch(r.label){case 0:return[4,this.widget.getProduct()];case 1:return t=r.sent(),n=e.data.map(function(e,n){return{mockup:e.mockup,previewMockups:e.previewMockups,surface:t.surfaces[n]}}),[4,t.setMockups(n,e.options)];case 2:return[2,r.sent()]}})})},t}(C)),_=n(52),x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.d(t,e),t.prototype.execute=function(e){return r.b(this,void 0,void 0,function(){var t=this;return r.e(this,function(n){switch(n.label){case 0:return[4,this.widget.iframeApiPromise];case 1:return n.sent(),[4,this.load(e.productDefinition,e.editorConfig,e.maximizeAssetManager||e.galleryObserverEnable)];case 2:return n.sent(),"string"==typeof e.productDefinition&&(this.widget._stateId=e.productDefinition,this.widget._userId=this.widget.driver.user.id),[2,_.Maybe.maybe(e).map(function(e){return e.viewerSettings}).caseOf({just:function(e){return t.widget.applyViewerSettings(e)},nothing:function(){return t.widget.customersCanvasPromise}})]}})})},t.prototype.load=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,s,o,a,u;return r.e(this,function(r){switch(r.label){case 0:return i=this,e.surfaces&&Array.isArray(e.surfaces)&&e.surfaces.forEach(function(e){"object"==typeof e&&void 0!==e.width&&void 0!==e.height&&(e.width=Number(e.width),e.height=Number(e.height))}),i.widget.modifiedItem&&i.widget.updateModifiedItem({}),s=this.widget.shadowRoot.querySelector("#design-editor"),[4,CustomersCanvas.IframeApi.loadEditor(s,e,t)];case 1:o=r.sent(),this.listenBoundsChanges(o),r.label=2;case 2:return r.trys.push([2,5,,6]),[4,o.getProduct()];case 3:return[4,(a=r.sent()).switchTo(a.surfaces[0])];case 4:return a=r.sent(),[3,6];case 5:return u=r.sent(),console.error("Load failed with exception: ",u),i.widget.dispatchEvent(new CustomEvent("error",u)),[2];case 6:return i.listenItemChanges(o),i.listenSurfaceChanges(o),i.widget.customersCanvasPublish(o),i.widget.dispatchEvent(new CustomEvent("ready",{detail:{product:a,customersCanvas:o}})),[4,this.widget.replaceInterpolationPlaceholder()];case 7:return r.sent(),n&&(i.listenModalClose(o),i.listenModalOpen(o),i.listenAssetManagerClose(o),i.listenAssetManagerOpen(o)),i.listenOriginalSize(o),i.listenFullWindow(o),[2]}})})},t.prototype.listenItemChanges=function(e){return r.b(this,void 0,void 0,function(){var t=this;return r.e(this,function(n){return e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.ItemChanged,function(e){return r.b(t,void 0,void 0,function(){var t;return r.e(this,function(n){switch(n.label){case 0:return w.a.isNullOrUndefined(e)?[2]:[4,this.widget.getDesignEditorItemModel(e)];case 1:return t=n.sent(),this.widget.updateModifiedItem(t),[2]}})})}),[2]})})},t.prototype.listenBoundsChanges=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.BoundsNotification,function(e){t.widget.updateOverallBounds(e.overallBounds)})},t.prototype.listenSurfaceChanges=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.OnSurfaceChanged,function(e){t.widget.updateCurrentSurfaceName()})},t.prototype.listenOriginalSize=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.OriginalSize,function(){t.widget.toggleMaximizeMainPanel(!1)})},t.prototype.listenFullWindow=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.FullWindow,function(){t.widget.toggleMaximizeMainPanel(!0)})},t.prototype.listenModalClose=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.ModalClose,function(){t.widget.toggleMaximizeMainPanel(!1)})},t.prototype.listenModalOpen=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.ModalOpen,function(){t.widget.toggleMaximizeMainPanel(!0)})},t.prototype.listenAssetManagerClose=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.AssetManagerClosed,function(){t.widget.toggleMaximizeMainPanel(!1)})},t.prototype.listenAssetManagerOpen=function(e){var t=this;e.subscribe(CustomersCanvas.IframeApi.PostMessage.Events.AssetManagerOpened,function(){t.widget.toggleMaximizeMainPanel(!0)})},t}(C),O=n(443),A=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.d(t,e),t.prototype.execute=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,s,o,a,u,c,l,d,h;return r.e(this,function(r){switch(r.label){case 0:return[4,this.widget.getEditor()];case 1:return[4,(t=r.sent()).getProduct()];case 2:return[4,(n=r.sent()).getProductModel()];case 3:return i=r.sent(),(void 0===(s=e.surfaceIndex)||null===s||s<0||s>i.surfaces.length)&&(s=0),o=i.surfaces.get(s),a=o.printAreas.get(0),u=o.containers.first(function(e){return e.name===O.a.BG_CONTAINER_NAME}),c=u.items.get(0),l=c.content,e.url.startsWith("public:")||e.url.startsWith("user:")?[4,t.configuration.getImageMetadata(e.url)]:[3,9];case 4:return d=r.sent(),(e.url.endsWith(".pdf")||e.url.endsWith(".svg"))&&(d.isVector=!0),!0!==e.toTile?[3,6]:((h=c.content||c).sourceRectangle.width=d.size.width,h.sourceRectangle.height=d.size.height,h.setData(d),h.source.isVector=d.isVector,u.items.setRange(this._getTiles(h,o)),[4,n.setProductModel(i)]);case 5:return r.sent(),[3,8];case 6:return n.surfaces.length>s?[4,n.surfaces[s].changeBackground(d)]:[3,8];case 7:r.sent(),r.label=8;case 8:return[3,12];case 9:return[4,l.loadImageFromRemoteUrl(CustomersCanvas.IframeApi.editorUrl,e.url)];case 10:return r.sent(),l.source.isVector=this._isVector(e.url),e.autoResize&&(o.width=l.sourceRectangle.width,o.height=l.sourceRectangle.height,a.bounds.width=o.width,a.bounds.height=o.height),!0===e.toTile&&u.items.setRange(this._getTiles(l,o)),[4,n.setProductModel(i)];case 11:r.sent(),r.label=12;case 12:return[4,this.widget.ready()];case 13:return r.sent(),[2]}})})},t.prototype._getTiles=function(e,t){for(var n=[],r=0,i=0;i<t.height;){for(;r<t.width;){var s=e.clone();s.values=[],s.transform.setTranslateX(r),s.transform.setTranslateY(i),s.locked=!0,n.push(s),r+=e.source.width}r=0,i+=e.source.height}return n},t.prototype._isVector=function(e){return e.endsWith(".pdf")||e.endsWith(".svg")},t}(C),E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.d(t,e),t.prototype.execute=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,s;return r.e(this,function(r){switch(r.label){case 0:return[4,this.widget.getProduct()];case 1:t=r.sent(),Array.isArray(e)||(e=[e]),n=0,r.label=2;case 2:return n<e.length?(i=e[n]).data?(s=t.currentSurface,"number"==typeof i.surfaceIndex&&(s=t.surfaces[i.surfaceIndex]),[4,s.setPrintAreas([i.data],i.options)]):[3,5]:[3,6];case 3:return t=r.sent(),[4,this.widget.replaceInterpolationPlaceholder()];case 4:r.sent(),r.label=5;case 5:return n++,[3,2];case 6:return[2]}})})},t}(C),j=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.d(t,e),t.prototype.execute=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,s,o,a,u,c,l,d,h,p,f,g;return r.e(this,function(m){switch(m.label){case 0:return null==e?[2,Promise.resolve()]:[4,this.widget.getEditor()];case 1:return[4,(i=m.sent()).getProduct()];case 2:return[4,(s=m.sent()).getProductModel()];case 3:o=m.sent(),m.label=4;case 4:m.trys.push([4,9,10,11]),a=r.j(e),u=a.next(),m.label=5;case 5:return u.done?[3,8]:(c=u.value,w.a.isNullOrUndefined(c.url)||""===c.url?[3,7]:(l="number"==typeof c.surfaceIndex?o.surfaces.get(c.surfaceIndex):o.surfaces.first(function(e){return e.name===s.currentSurface.name}),(d="up"===c.mockup.toLowerCase()?l.mockup.overContainers:l.mockup.underContainers).empty||d.get(0).items.empty?(console.warn("Cannot set mockup because MockupContainer is empty"),[3,7]):(h=d.get(0).items,p=h.get(0),[4,i.configuration.getImageMetadata(c.url)])));case 6:(f=m.sent()).size={width:f.size.width||f.width,height:f.size.height||f.height},f.name=p.name,p.setData(f),m.label=7;case 7:return u=a.next(),[3,5];case 8:return[3,11];case 9:return g=m.sent(),t={error:g},[3,11];case 10:try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}return[7];case 11:return[4,s.setProductModel(o)];case 12:return m.sent(),[2]}})})},t}(C),S=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.d(t,e),t.prototype.execute=function(e){return r.b(this,void 0,void 0,function(){return r.e(this,function(t){switch(t.label){case 0:return"string"==typeof e?e={theme:e}:void 0===e.theme&&(e={theme:e}),[4,this.widget.getProduct()];case 1:return[4,t.sent().applyProductTheme(e.theme)];case 2:return[2,t.sent()]}})})},t}(C),M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.d(t,e),t.prototype.execute=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,s,o,a,u,c,l,d,h,p,f,g,m,v,b,y;return r.e(this,function(w){switch(w.label){case 0:return null!=e&&e instanceof Array?[4,this.widget.getProduct()]:[2];case 1:o=w.sent(),w.label=2;case 2:w.trys.push([2,14,15,16]),a=r.j(e),u=a.next(),w.label=3;case 3:if(u.done)return[3,13];if(c=u.value,l=e.indexOf(c),null==(d=o.surfaces[l]))return[3,12];w.label=4;case 4:w.trys.push([4,10,11,12]),h=r.j(Object.entries(c)),p=h.next(),w.label=5;case 5:return p.done?[3,9]:(f=r.h(p.value,2),g=f[0],m=f[1],null==(v=d.printAreas[0].getContainer(g))?[3,7]:[4,v.update(m)]);case 6:return w.sent(),[3,8];case 7:console.warn("Container with name "+g+" was not found!"),w.label=8;case 8:return p=h.next(),[3,5];case 9:return[3,12];case 10:return b=w.sent(),i={error:b},[3,12];case 11:try{p&&!p.done&&(s=h.return)&&s.call(h)}finally{if(i)throw i.error}return[7];case 12:return u=a.next(),[3,3];case 13:return[3,16];case 14:return y=w.sent(),t={error:y},[3,16];case 15:try{u&&!u.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}return[7];case 16:return[2]}})})},t}(C),R=n(390),T=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.d(t,e),t.prototype.execute=function(e,t){return r.b(this,void 0,void 0,function(){var n,i;return r.e(this,function(r){switch(r.label){case 0:return w.a.isEmptyObject(e)||w.a.isEmptyObject(e.every)&&w.a.isEmptyObject(e.items)?[2,Promise.resolve()]:(e.items=e.items||{},w.a.isNotNullOrUndefined(t)&&(e=this._removeOldParams(e,t)),[4,this.widget.getEditor()]);case 1:return[4,(n=r.sent()).getProduct()];case 2:return i=r.sent(),[4,this._modifyItems(e,i,n)];case 3:return r.sent(),[4,this._applyUserInfo(n,e)];case 4:return r.sent(),[2]}})})},t.prototype._modifyItems=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,s,o,a,u,c,l,d,h,p;return r.e(this,function(f){switch(f.label){case 0:return[4,t.getProductModel()];case 1:return o=f.sent(),w.a.isNullOrUndefined(e)?[2]:w.a.isNotNullOrUndefined(e.items)?[4,this._applyBackgroundColor(e,t)]:[3,3];case 2:f.sent(),f.label=3;case 3:a=o.getAllItems(),f.label=4;case 4:f.trys.push([4,13,14,15]),u=r.j(a),c=u.next(),f.label=5;case 5:return c.done?[3,12]:(l=c.value,d=r.a({},e.every,e.items[l.name]),0===Object.keys(d).length?[3,11]:this.needApplyOnce(d,l)?this._isTextItem(l.type)?(this._updateTextItem(d,l),[3,10]):[3,6]:[3,11]);case 6:return l.type!==R.PlaceholderItem.type?[3,8]:[4,this._updatePlaceholderItem(d,l,n)];case 7:return f.sent(),[3,10];case 8:return l.type!==R.ShapeItem.type?[3,10]:[4,this._updateShapeItem(d,l)];case 9:f.sent(),f.label=10;case 10:this._updateVisualizationPermissions(d,l),this.setApplyOnce(d,l),f.label=11;case 11:return c=u.next(),[3,5];case 12:return[3,15];case 13:return h=f.sent(),i={error:h},[3,15];case 14:try{c&&!c.done&&(s=u.return)&&s.call(u)}finally{if(i)throw i.error}return[7];case 15:return p=t.currentSurfaceIndex>0?t.currentSurfaceIndex:0,[4,t.setProductModel(o)];case 16:return f.sent(),[4,n.getProduct()];case 17:return[4,(t=f.sent()).switchTo(t.surfaces[p])];case 18:return f.sent(),[2]}})})},t.prototype.needApplyOnce=function(e,t){return!(!0===e.once&&t&&t.tags.modifyItems&&!0===t.tags.modifyItems.once)},t.prototype.setApplyOnce=function(e,t){!0===e.once&&t&&(t.tags.modifyItems=t.tags.modifyItems||{},t.tags.modifyItems.once=!0)},t.prototype._isTextItem=function(e){return e===R.BaseTextItem.type||e===R.BoundedTextItem.type||e===R.PlainTextItem.type||e===R.CurvedTextItem.type||e===R.AutoScaledTextItem.type},t.prototype._removeOldParams=function(e,t){for(var n in e.items){var r=t.items[n],i=e.items[n];JSON.stringify(r)===JSON.stringify(i)&&!0!==i.force&&delete e.items[n]}return e},t.prototype._applyBackgroundColor=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,s,o,a,u,c;return r.e(this,function(l){switch(l.label){case 0:if(null==(s=e.items.background)||null==s.color)return[3,8];o=window.CustomersCanvas.DesignAtoms.ObjectModel.ColorFactory.createColor(s.color),l.label=1;case 1:l.trys.push([1,6,7,8]),a=r.j(t.surfaces),u=a.next(),l.label=2;case 2:return u.done?[3,5]:[4,u.value.changeBackground(o)];case 3:l.sent(),l.label=4;case 4:return u=a.next(),[3,2];case 5:return[3,8];case 6:return c=l.sent(),n={error:c},[3,8];case 7:try{u&&!u.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}return[7];case 8:return[2]}})})},t.prototype._updateTextItem=function(e,t){var n=e.text||e.value;if(null!=n&&(t.text=n),t.placeholders&&t.placeholders.length>0&&(t.placeholders.forEach(function(e){return e.value=n}),t.value=n),null!=e.font){var r=e.font.bold||e.font.fauxBold;r&&(t.font.fauxBold=r);var i=e.font.italic||e.font.fauxItalic;i&&(t.font.fauxItalic=i);var s=e.font.family||e.font.postScriptName;s&&(t.font.postScriptName=s),e.font.size&&(t.font.size=e.font.size),e.font.underline&&(t.underline=e.font.underline);var o=e.color||e.font.color;o&&(t.color=window.CustomersCanvas.DesignAtoms.ObjectModel.ColorFactory.createColor(o))}if((!0===e.locked&&(t.textPermissions.allowChangeText=!1,t.textPermissions.allowChangeTextBIU=!1),t.type===R.PlainTextItem.type)&&(l=e.position||e.location)){var a=0,u=0,c=t;t.alignment=R.TextAlignment.Left,l||(l={x:0,y:0}),a=l.x||c.baselineLocation.x,u=l.y||c.baselineLocation.y,c.baselineLocation=new window.CustomersCanvas.DesignAtoms.ObjectModel.PointF(a,u)}if(t.type===R.BoundedTextItem.type||t.type===R.AutoScaledTextItem.type){var l,d=t;if((l=e.position||e.location)||e.size){var h,p;a=0,u=0;l||(l={x:0,y:0}),a=l.x||d.textRectangle.left,u=l.y||d.textRectangle.top,e.size||(e.size={width:0,height:0}),h=e.size.width||d.textRectangle.width,p=e.size.height||d.textRectangle.height,d.textRectangle.width=h,d.textRectangle.height=p,d.textRectangle.left=a,d.textRectangle.top=u}}},t.prototype._updateVisualizationPermissions=function(e,t){e.visualizationPermissions&&(w.a.isNotNullOrUndefined(e.visualizationPermissions.noPrint)&&(t.visualizationPermissions.noPrint=e.visualizationPermissions.noPrint),w.a.isNotNullOrUndefined(e.visualizationPermissions.noShow)&&(t.visualizationPermissions.noShow=e.visualizationPermissions.noShow)),w.a.isNotNullOrUndefined(e.locked)&&(t.locked=e.locked)},t.prototype._updatePlaceholderItem=function(e,t,n){return r.b(this,void 0,void 0,function(){var i,s,o,a,u,c,l,d,h,p,f,g;return r.e(this,function(r){switch(r.label){case 0:return i=function(e){return e.placeholderContent&&e.tags&&e.tags.sourceData&&e.value===e.tags.sourceData.name},"ImagePlaceholder"!==e.type?[3,6]:i(e)?-1!==e.placeholderContent.originalUrl.indexOf("?x-cctoken=")?[3,2]:[4,this.widget.getToken()]:[3,4];case 1:""!==(s=r.sent())&&(e.placeholderContent.originalUrl+="?x-cctoken="+s),r.label=2;case 2:return o=e.placeholderContent.originalUrl,e.tags.sourceData.originalUrl=o,[4,n.configuration.getImageMetadata(o)];case 3:return a=r.sent(),p=t.content,t.isStubContent=!1,p.setData(a),p.tags=e.tags,p.parentPlaceholder=t,f=new b.a(t),(g=new v.a(p)).updateRectangle(!1,t.contentResizeMode,f),u=f.getTransformedRectangle(),c=e.placeholderContent,(u.angle!==c.placeholderRectangle.angle||u.width!==c.placeholderRectangle.width||u.height!==c.placeholderRectangle.height||u.centerX!==c.placeholderRectangle.centerX||u.centerY!==c.placeholderRectangle.centerY)&&(l=new window.CustomersCanvas.DesignAtoms.ObjectModel.RotatedRectangleF(c.placeholderRectangle.centerX,c.placeholderRectangle.centerY,c.placeholderRectangle.width,c.placeholderRectangle.height,c.placeholderRectangle.angle),f.setTransformedRectangle(l)),d=g.getTransformedRectangle(),(d.angle!==c.contentRectangle.angle||d.width!==c.contentRectangle.width||d.height!==c.contentRectangle.height||d.centerX!==c.contentRectangle.centerX||d.centerY!==c.contentRectangle.centerY)&&(h=new window.CustomersCanvas.DesignAtoms.ObjectModel.RotatedRectangleF(c.contentRectangle.centerX,c.contentRectangle.centerY,c.contentRectangle.width,c.contentRectangle.height,c.contentRectangle.angle),g.setTransformedRectangle(h)),[3,5];case 4:t.isStubContent||((p=t.content).parentPlaceholder=t,p.setData(t.stubStorageMeta),f=new b.a(t),(g=new v.a(p)).parentPlaceholder=f,g.updateRectangle(!1,t.contentResizeMode,f),t.isStubContent=!0),r.label=5;case 5:e.contentPermissions&&e.contentPermissions.imagePermissions&&(t.contentPermissions.imagePermissions.allowChangeImage=e.contentPermissions.imagePermissions.allowChangeImage,t.contentPermissions.imagePermissions.allowEditImage=e.contentPermissions.imagePermissions.allowEditImage),e.placeholderPermissions&&(t.placeholderPermissions.allowEditContent=e.placeholderPermissions.allowEditContent,t.placeholderPermissions.showHandleButton=e.placeholderPermissions.showHandleButton,t.placeholderPermissions.showSelectButton=e.placeholderPermissions.showSelectButton),r.label=6;case 6:return"BarcodePlaceholder"===e.type&&(e.value||t.isStubContent||(t.content.applyBarcodeData(new window.CustomersCanvas.DesignAtoms.ObjectModel.BarcodeData("")),t.isStubContent=!0)),[2]}})})},t.prototype._updateShapeItem=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,s,o,a,u;return r.e(this,function(r){return(n=e.color||e.fillColor)&&(t.fillColor=window.CustomersCanvas.DesignAtoms.ObjectModel.ColorFactory.createColor(n)),((i=e.position||e.location)||e.size)&&(s=0,o=0,a=0,u=0,i||(i={x:0,y:0}),s=i.x||t.sourceRectangle.left,o=i.y||t.sourceRectangle.top,e.size||(e.size={width:0,height:0}),a=e.size.width||t.sourceRectangle.width,u=e.size.height||t.sourceRectangle.height,t.sourcePath=window.CustomersCanvas.DesignAtoms.ObjectModel.Path.rectangle(s,o,a,u)),[2]})})},t.prototype._applyUserInfo=function(e,t){return r.b(this,void 0,void 0,function(){var n,i,s,o,a,u,c,l,d,h,p,f;return r.e(this,function(g){switch(g.label){case 0:return s=function(e){return!!e.placeholderContent&&e.tags&&e.tags.sourceData&&e.value===e.tags.sourceData.name},[4,e.getProduct()];case 1:return[4,g.sent().getProductModel()];case 2:o=g.sent(),a=o.getAllItems(),u={},c=function(e){var n=t.items[e],r=a.find(function(t){return t.name===e});return l.needApplyOnce(n,r)&&(n.value||"Text"===n.type||"InString"===n.type||n.image)?"ImagePlaceholder"===n.type&&s(n)?"continue":("BarcodePlaceholder"===n.type?n.barcodeSubType&&"None"!==n.barcodeSubType?"Url"===n.barcodeSubType?u[e]={BarcodeFormat:n.barcodeFormat,BarcodeSubType:n.barcodeSubType,Url:n.value}:"Phone"===n.barcodeSubType&&(u[e]={barcodeFormat:n.barcodeFormat,barcodeSubType:n.barcodeSubType,phone:n.value}):u[e]={barcodeFormat:n.barcodeFormat,barcodeValue:n.value}:u[e]=w.a.isNotNullOrUndefined(n.value)?n.value:n.image,void l.setApplyOnce(n,r)):"continue"},l=this;try{for(d=r.j(Object.keys(t.items)),h=d.next();!h.done;h=d.next())p=h.value,c(p)}catch(e){n={error:e}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(n)throw n.error}}if(w.a.isEmptyObject(u))return[2,Promise.resolve()];g.label=3;case 3:return g.trys.push([3,5,,6]),[4,e.loadUserInfo(u)];case 4:return g.sent(),[3,6];case 5:return f=g.sent(),this.widget.showToast("Error: Invalid data"),console.log(f),[3,6];case 6:return[2]}})})},t}(C),F=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.d(t,e),t.prototype.execute=function(e){return r.b(this,void 0,void 0,function(){var t,n;return r.e(this,function(r){switch(r.label){case 0:return e?[4,this.widget.getEditor()]:[3,3];case 1:return t=r.sent(),n=Object.assign({},e),null!=e.scrollPosition&&(n.scrollingPosition={x:e.scrollPosition.X||e.scrollPosition.x,y:e.scrollPosition.Y||e.scrollPosition.y}),[4,t.setViewerSettings(n)];case 2:r.sent(),r.label=3;case 3:return[2]}})})},t}(C),z=n(373),N=n(542),D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._configProcessor=new N.a,t}return r.d(t,e),t.prototype.execute=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,s,o,a,u,c,l,d;return r.e(this,function(h){switch(h.label){case 0:return i=this._configProcessor.process(e,{}),[4,this.widget.getProduct()];case 1:return[4,(s=h.sent()).getProductModel()];case 2:return[4,(o=h.sent()).getAllItems()];case 3:a=h.sent();try{for(u=r.j(a),c=u.next();!c.done;c=u.next())l=c.value,d=i.items[l.name],w.a.isNotNullOrUndefined(d)||Object(z.b)(l,d)}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}return[4,s.setProductModel(o)];case 4:return h.sent(),[2]}})})},t}(C),k=n(437),U=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._serializer=new k.a,t}return r.d(t,e),t.prototype.execute=function(e){return r.b(this,void 0,void 0,function(){var t;return r.e(this,function(n){switch(n.label){case 0:if(Object(z.e)(e.serializedProduct))throw"serializedProduct cannot be null or empty";return t=this._serializer.deserialize(e.serializedProduct),[4,this.widget.getProduct()];case 1:return[4,n.sent().setProductModel(t)];case 2:return n.sent(),[2]}})})},t}(C),B=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.d(t,e),t.prototype.execute=function(e){return r.b(this,void 0,void 0,function(){return r.e(this,function(t){switch(t.label){case 0:return e&&e.surfaces&&0!==e.surfaces.length?e.surfaces.some(function(e){return 0===Object.keys(e).length})?[2]:[4,this.widget.getEditor()]:[2];case 1:return[4,t.sent().getProduct()];case 2:return[4,t.sent().setSurfaces(e.surfaces)];case 3:return t.sent(),[4,this.widget.replaceInterpolationPlaceholder()];case 4:return t.sent(),[2]}})})},t}(C),V=n(475),W=n(1),J=n(20),H=n(476),L=function(){function e(){this.promise=new Promise(function(e,t){this._resolve=e,this._reject=t}.bind(this))}return e.prototype.then=function(e){return this.promise.then(e)},e.prototype.catch=function(e){return this.promise.catch(e)},e.prototype.resolve=function(e){void 0===e&&(e=""),this._resolve(e)},e.prototype.reject=function(e){this._reject(e)},e}(),X=n(194),Y=n(540);n.d(t,"AuWidgetDesignEditor",function(){return G}),n.d(t,"widget",function(){return G});var G=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._isRestoring=!1,t.CC_SCRIPT_RELATIVE_PATH="/Resources/Generated/IframeApi.js",t.modifiedItem=null,t._currentSurfaceName="",t.overallBounds={},t._hiResUrls=[],t._proofImageUrls=[[]],t._stateId="",t._userId="",t._userChanges={},t._variableData=[],t._allItems=[],t._depositPhotos=[],t._tags={},t._lastParams={},t._currentParams={},t.actionsFinished=!1,t.actionsFinishedPromise=new L,t.commands={initial:new x(t),changeMockup:new I(t),setPrintArea:new E(t),setTheme:new S(t),setBackground:new A(t),updateContainerSettings:new M(t),setRemoteMockup:new j(t),modifyItems:new T(t),setViewerSettings:new F(t),updateItems:new D(t),setSerializedProduct:new U(t),setSurfaces:new B(t)},t.itemsData={},t._token="",t}return r.d(t,e),Object.defineProperty(t.prototype,"currentSurfaceName",{get:function(){return this._currentSurfaceName},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"proofImageUrls",{get:function(){return this._proofImageUrls},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hiResUrls",{get:function(){return this._hiResUrls},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"stateId",{get:function(){return this._stateId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userChanges",{get:function(){return this._userChanges},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"userId",{get:function(){return this._userId},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"allItems",{get:function(){return this._allItems},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"variableData",{get:function(){return this._variableData},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"depositPhotos",{get:function(){return this._depositPhotos},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tags",{get:function(){return this._tags},enumerable:!0,configurable:!0}),t.prototype.updateParams=function(e){if(void 0!==e.initial&&(e.initial.editorConfig||(e.initial.editorConfig={}),e.initial.editorConfig.defaultLanguage=this.driver.config.language||"en",this.driver)){this._initialOrder=this._initialOrder||Object(y.a)(this.driver.orders[0]);var t=this.driver.user.id;t&&(e.initial.editorConfig.userId=t);var n=this.driver.user.tokenId;n&&(e.initial.editorConfig.tokenId=n);var r=this.auWizard.scopeInternal.widgetsData,i=r&&r[this.name]?r[this.name].stateId:this._initialOrder.data.stateId;i&&""!==i&&(e.initial.productDefinition=i),e.initial.editorConfig.preloader={enabled:!1}}},t.prototype.exportWidgetData=function(e){return r.b(this,void 0,void 0,function(){return r.e(this,function(t){switch(t.label){case 0:return!0!==e?[3,2]:[4,this.saveProduct()];case 1:t.sent(),t.label=2;case 2:return[2,{stateId:this._stateId}]}})})},t.prototype.restoreWidgetFromData=function(e,t){return void 0===t&&(t=!1),r.b(this,void 0,void 0,function(){var n;return r.e(this,function(r){switch(r.label){case 0:return!0!==t?[3,2]:((n=Object.assign({},this.params.initial)).productDefinition=e.stateId,[4,this.commands.initial.execute(n)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.updateParamsAsync=function(t){return r.b(this,void 0,void 0,function(){var n,i,s,o,a,u,c,l;return r.e(this,function(r){switch(r.label){case 0:return[4,e.prototype.updateParamsAsync.call(this,t)];case 1:if(r.sent(),0===(n=this._commandExecuter.getChangedActions(t,this._currentParams)).length)return[2,!1];-1!==n.indexOf("initial")&&(i=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/,s=w.a.isNotNullOrUndefined(this._stateId)&&""!==this._stateId,o=w.a.isNotNullOrUndefined(t.initial.productDefinition)&&t.initial.productDefinition.toString().match(i),(s||o)&&(n=["initial"])),this.actionsFinishedPromise=new L,this.actionsFinished=!1,this.emitChange(),(a=n.every(function(e){var n=t[e];return Array.isArray(t[e])&&(n=t[e][0]),!1===n.showPreloader}))||this.showPreloader(!0),this._currentParams=Object(y.a)(t),r.label=2;case 2:return r.trys.push([2,4,5,6]),[4,this._commandExecuter.executeActions(t,n,this._lastParams)];case 3:return r.sent(),[3,6];case 4:return u=r.sent(),this.params.actionsErrorToast&&!0===this.params.actionsErrorToast.show&&(c="widgets.canvas.actions.error",(l=this.localize(c))===c&&(l="Something went wrong. Send the website support team information about your browser and steps to reproduce the problem."),this.showToast(l,this.params.actionsErrorToast.duration)),this.logger.error(function(){return"Failed to perform an action on Design Editor. "},u),[3,6];case 5:return a||this.showPreloader(!1),this._lastParams=t,this.actionsFinishedPromise.resolve(),this.actionsFinished=!0,this.emitChange(),[7];case 6:return[2]}})})},t.prototype.connectedCallback=function(){var t=this;e.prototype.connectedCallback.call(this),this._commandExecuter=new H.a(this.commands,this.uniqWidgetName),this.baseUrl=this.driver.settings.customersCanvasBaseUrl,this.showPreloader(!0),this.iframeApiPromise=V.a.loadCCScript(this.baseUrl,this.CC_SCRIPT_RELATIVE_PATH),this.iframeApiPromise.then(function(){t.showPreloader(!1),CustomersCanvas.IframeApi.editorUrl=t.baseUrl})},t.prototype.switchSurfaceTo=function(e){return r.b(this,void 0,void 0,function(){var t;return r.e(this,function(n){switch(n.label){case 0:return[4,this.getProduct()];case 1:return t=n.sent(),(e<0||e>t.surfaces.length-1)&&this.logger.error("Invalid surface index: "+e,Error),[4,t.switchTo(t.surfaces[e])];case 2:return[2,n.sent()]}})})},t.prototype.updateModifiedItem=function(e){Object(Y.a)(this.modifiedItem,e)||(this.modifiedItem=e,this.emitChange({modifiedItem:this.modifiedItem},!1))},t.prototype.updateOverallBounds=function(e){Object(Y.a)(this.overallBounds,e)||(this.overallBounds=e,this.emitChange({overallBounds:this.overallBounds},!1))},t.prototype.updateCurrentSurfaceName=function(){return r.b(this,void 0,void 0,function(){var e;return r.e(this,function(t){switch(t.label){case 0:return[4,this.getProduct()];case 1:return e=t.sent(),this._currentSurfaceName=e.currentSurface.name,this.emitChange(),[2]}})})},t.prototype.applyViewerSettings=function(e){return r.b(this,void 0,void 0,function(){return r.e(this,function(t){return[2,this.commands.setViewerSettings.execute(e)]})})},t.prototype.getProofImages=function(e,t,n,i,s,o,a){return void 0===e&&(e=800),void 0===t&&(t=800),void 0===n&&(n=!1),void 0===i&&(i=!1),void 0===s&&(s=!1),void 0===o&&(o=1e3),void 0===a&&(a=1e3),r.b(this,void 0,void 0,function(){var u,c,l;return r.e(this,function(r){switch(r.label){case 0:return[4,this.getEditor()];case 1:return u=r.sent(),c={},c="object"==typeof e?e:{maxWidth:e,maxHeight:t,pregeneratePreviewImages:n,generateProductProof:i,generateLargePreviews:s,largePreviewMaxWidth:o,largePreviewMaxHeight:a},[4,u.getProofImages(c)];case 2:return l=r.sent(),this._proofImageUrls=l.proofImageUrls,this.emitChange({urls:this.proofImageUrls},!0),[2,l.proofImageUrls.map(function(e){return e[0]})]}})})},t.prototype.getHiResImages=function(e,t,n,i,s){return void 0===e&&(e=800),void 0===t&&(t=800),void 0===i&&(i=!1),r.b(this,void 0,void 0,function(){var o,a;return r.e(this,function(r){switch(r.label){case 0:return[4,this.getEditor()];case 1:return o=r.sent(),null!==n&&""!==n||(n=void 0),[4,o.finishProductDesign({stateId:n,proofMaxWidth:e,proofMaxHeight:t,pregeneratePreviewImages:i,fileName:s})];case 2:return a=r.sent(),this._hiResUrls=a.hiResOutputUrls,this._proofImageUrls=a.proofImageUrls,this._stateId=a.stateId,this._userId=a.userId,this._userChanges=a.userChanges,this.emitChange({urls:this.hiResUrls,proofs:this.proofImageUrls,stateId:this.stateId,userId:this.userId,userChanges:this.userChanges},!0),[2,a.hiResOutputUrls]}})})},t.prototype.getVariableData=function(){return r.b(this,void 0,void 0,function(){var e,t;return r.e(this,function(n){switch(n.label){case 0:return[4,this.getProduct()];case 1:return e=n.sent(),t=this,[4,e.getVariableItems()];case 2:return t._variableData=n.sent().reverse(),this.emitChange({data:this.variableData}),[2,this.variableData]}})})},t.prototype.getAllItems=function(){return r.b(this,void 0,void 0,function(){var e;return r.e(this,function(t){switch(t.label){case 0:return[4,this.getProduct()];case 1:return[4,t.sent().getProductModel()];case 2:return e=t.sent(),this._allItems=e.getAllItems().reverse(),this.emitChange(),[2,this.allItems]}})})},t.prototype.getDepositPhotos=function(){return r.b(this,void 0,void 0,function(){var e,t;return r.e(this,function(n){switch(n.label){case 0:return[4,this.getProduct()];case 1:return[4,n.sent().getAllItems()];case 2:return e=n.sent(),t=[],e.forEach(function(e){var n=e.tags.dp_data;Object(X.a)(n)||t.push({imageId:e.id,depositPhotosId:JSON.parse(n).id})}),this._depositPhotos=t,this.emitChange({data:this.depositPhotos}),[2,t]}})})},t.prototype.getTags=function(){return r.b(this,void 0,void 0,function(){var e,t;return r.e(this,function(n){switch(n.label){case 0:return[4,this.getProduct()];case 1:return e=n.sent(),t=this,[4,e.getTags()];case 2:return t._tags=n.sent(),void 0===this._tags&&(this._tags={}),this.emitChange({tags:this.tags}),[2,this.tags]}})})},t.prototype.setTags=function(e){return r.b(this,void 0,void 0,function(){return r.e(this,function(t){switch(t.label){case 0:return[4,this.getProduct()];case 1:return[4,t.sent().setTags(e)];case 2:return t.sent(),this._tags=e,this.emitChange({tags:this.tags}),[2]}})})},t.prototype.saveProduct=function(e){return r.b(this,void 0,void 0,function(){var t;return r.e(this,function(n){switch(n.label){case 0:return[4,this.getEditor()];case 1:return[4,n.sent().saveProduct(e)];case 2:return t=n.sent(),this._stateId=t.stateId,this._userId=t.userId,this.emitChange({stateId:this.stateId,userId:this.userId},!0),[2,t]}})})},t.prototype.replaceInterpolationPlaceholder=function(){return r.b(this,void 0,void 0,function(){return r.e(this,function(e){switch(e.label){case 0:return this._currentParams.replaceInterpolationPlaceholders?[4,this.getEditor()]:[2,Promise.resolve()];case 1:return e.sent().replaceInterpolationPlaceholders(),[2]}})})},t.prototype.toggleMaximizeMainPanel=function(e){this.publishData({main:e},J.a.TOGGLE_SIZE_MAIN)},t.prototype.openAssetManagerFor=function(e){return r.b(this,void 0,void 0,function(){return r.e(this,function(t){switch(t.label){case 0:return[4,this.getEditor()];case 1:return[4,t.sent().openGalleryForItem(e)];case 2:return t.sent(),[2]}})})},t.prototype.getItemText=function(e){return r.b(this,void 0,void 0,function(){var t,n,i,s;return r.e(this,function(r){switch(r.label){case 0:return[4,this.getEditor()];case 1:return[4,r.sent().getProduct()];case 2:return[4,r.sent().getProductModel()];case 3:return t=r.sent(),n=t.getAllItems(),i=n.find(function(t){return t.name===e}),s=i&&i instanceof R.BaseTextItem?i.text:"",this.itemsData[e]=this.itemsData[e]||{},this.itemsData[e].text=s,this.emitChange(),[2,s]}})})},Object.defineProperty(t.prototype,"token",{get:function(){return this._token},enumerable:!0,configurable:!0}),t.prototype.getToken=function(){return r.b(this,void 0,void 0,function(){var e,t;return r.e(this,function(n){switch(n.label){case 0:return[4,this.getEditor()];case 1:e=n.sent(),t="",n.label=2;case 2:return n.trys.push([2,4,,5]),[4,e.eval("spEditor.configuration.tokenId;")];case 3:return t=n.sent(),[3,5];case 4:return n.sent(),console.error("Failed to get user token"),[3,5];case 5:return this._token=t,this.emitChange(),[2,t]}})})},t=r.c([Object(W.a)("au-widget-design-editor",i)],t)}(P)}}]);